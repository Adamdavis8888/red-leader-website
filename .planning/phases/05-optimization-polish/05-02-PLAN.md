---
phase: 05-optimization-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/not-found.tsx
  - app/error.tsx
  - app/global-error.tsx
  - app/(marketing)/layout.tsx
autonomous: true

must_haves:
  truths:
    - "Visitors see helpful 404 page when accessing non-existent URLs"
    - "Application errors are caught and displayed gracefully"
    - "Users can navigate back to working pages from error states"
    - "Error boundaries prevent full page crashes"
  artifacts:
    - path: "app/not-found.tsx"
      provides: "Custom 404 page"
      min_lines: 20
    - path: "app/error.tsx"
      provides: "Error boundary component"
      exports: ["default"]
    - path: "app/global-error.tsx"
      provides: "Root error boundary"
      exports: ["default"]
  key_links:
    - from: "app/not-found.tsx"
      to: "app/components/Header.tsx"
      via: "visual consistency"
      pattern: "Link.*href"
    - from: "app/error.tsx"
      to: "/"
      via: "recovery navigation"
      pattern: "href=[\"']/[\"']"
---

<objective>
Implement graceful error handling with custom 404 and error boundary pages.

Purpose: Ensure visitors encountering errors can recover and continue engaging with the site, maintaining professional appearance during failures.

Output: Custom 404 page, error boundary component, and global error handler.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

Design patterns from existing pages:
@app/(marketing)/page.tsx
@app/components/Header.tsx
@app/(marketing)/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create custom 404 not-found page</name>
  <files>
    app/not-found.tsx
  </files>
  <action>
Create a branded 404 page that matches site design:

**app/not-found.tsx:**
- Import Link from 'next/link'
- Import Header and Footer from components (for consistent navigation)
- Create default export function NotFound()
- Use the same Inter font and brand colors from existing pages

Layout structure:
1. Header component at top
2. Main content centered vertically with:
   - Large "404" text in brand-red color
   - Heading: "Page Not Found"
   - Subtext: "The page you're looking for doesn't exist or has been moved."
   - Two CTA buttons:
     - Primary (brand-red bg): "Go Home" linking to /
     - Secondary (outlined): "View Services" linking to /services
   - Emergency callout at bottom: "Having an infrastructure emergency? Call us now: [phone]"
3. Footer component at bottom

Use Tailwind classes consistent with existing pages:
- max-w-7xl container
- brand-dark, brand-red, brand-gray color classes
- Responsive text sizes (text-4xl sm:text-5xl)
- Proper spacing (py-16, px-4, etc.)

Include metadata export:
```typescript
export const metadata = {
  title: '404 - Page Not Found | Red Leader',
  description: 'The page you requested could not be found.',
}
```
  </action>
  <verify>
Visit a non-existent URL like /this-page-does-not-exist.
Confirm 404 page renders with:
- Header and footer present
- "404" text visible
- Navigation links work
- Emergency phone number displayed
  </verify>
  <done>
Custom 404 page renders for any non-existent route.
Page includes navigation back to main site.
Emergency contact visible for urgent visitors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create error boundary and global error handler</name>
  <files>
    app/error.tsx
    app/global-error.tsx
  </files>
  <action>
Create error handling components:

**app/error.tsx:**
- Add 'use client' directive (required for error boundaries)
- Import useEffect from 'react'
- Import Link from 'next/link'
- Define Error component with props: { error: Error & { digest?: string }, reset: () => void }
- Use useEffect to log error to console (placeholder for future error reporting)
- Render user-friendly error page:
  - Heading: "Something went wrong"
  - Subtext: "We've encountered an unexpected error. Our team has been notified."
  - "Try Again" button calling reset()
  - "Go Home" link to /
  - Emergency contact info (same as 404)
- Use same brand colors and container classes
- Export as default

**app/global-error.tsx:**
- Add 'use client' directive
- This catches errors in the root layout itself
- Import same dependencies
- Same error/reset props
- MUST render complete html and body tags (this replaces root layout on error)
- Include basic styling inline or minimal Tailwind
- Show generic error message with reset and home link
- Export as default

Styling notes:
- error.tsx inherits layout, so can use Header/Footer from parent
- global-error.tsx cannot use components, must be self-contained
- Both should have professional appearance matching brand
- Red "alert" indicator or icon to show error state
  </action>
  <verify>
Test error boundary by temporarily adding:
```javascript
if (true) throw new Error('Test error')
```
to a page component, then verify:
- Error page renders (not white screen)
- "Try Again" button triggers reset
- "Go Home" link navigates properly
Remove test error after verification.
  </verify>
  <done>
error.tsx catches and displays runtime errors gracefully.
global-error.tsx handles root layout errors.
Both provide recovery paths (reset, go home).
Error is logged for debugging.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` succeeds
2. Visit /non-existent-page - shows custom 404
3. Click links on 404 page - navigation works
4. Error boundary catches thrown errors (verify with temporary test)
5. All error pages include emergency contact
</verification>

<success_criteria>
1. Custom 404 page with brand styling and navigation
2. Error boundary catches runtime errors
3. Global error handler catches root layout errors
4. Users can recover from error states via reset or navigation
5. Emergency contact visible on all error pages
6. Error logging in place (console for now)
</success_criteria>

<output>
After completion, create `.planning/phases/05-optimization-polish/05-02-SUMMARY.md`
</output>
