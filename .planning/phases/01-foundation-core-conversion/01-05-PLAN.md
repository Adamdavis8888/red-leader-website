---
phase: 01-foundation-core-conversion
plan: 05
type: execute
wave: 3
depends_on: ["01-02", "01-03"]
files_modified:
  - app/(marketing)/contact/page.tsx
  - app/components/ContactForm.tsx
  - app/actions/contact.ts
  - app/lib/schemas.ts
autonomous: true

must_haves:
  truths:
    - "Visitor can submit contact form with name, email, company, and message"
    - "Form validates input and shows errors"
    - "Form shows success message after submission"
    - "Page includes Calendly embed for booking"
    - "Page includes multiple contact methods (phone, email)"
  artifacts:
    - path: "app/(marketing)/contact/page.tsx"
      provides: "Contact page with form and contact methods"
      exports: ["default"]
    - path: "app/components/ContactForm.tsx"
      provides: "Client component with form handling"
      exports: ["ContactForm"]
    - path: "app/actions/contact.ts"
      provides: "Server Action for form submission"
      exports: ["submitContactForm"]
    - path: "app/lib/schemas.ts"
      provides: "Zod validation schema"
      exports: ["contactSchema"]
  key_links:
    - from: "app/components/ContactForm.tsx"
      to: "app/actions/contact.ts"
      via: "Server Action import"
      pattern: "import.*submitContactForm"
    - from: "app/actions/contact.ts"
      to: "app/lib/schemas.ts"
      via: "schema import"
      pattern: "import.*contactSchema"
---

<objective>
Build the contact page with form submission via Server Actions and Calendly booking embed.

Purpose: The contact page is a critical conversion point. It provides multiple ways to reach Red Leader: contact form, phone, email, and booking. The form uses Server Actions with Zod validation for a smooth, secure user experience.

Output: Complete contact page with validated form, multiple contact methods, and Calendly booking widget.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-core-conversion/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Zod schema and Server Action for contact form</name>
  <files>
    app/lib/schemas.ts
    app/actions/contact.ts
  </files>
  <action>
Create app/lib/schemas.ts with contact form validation:

```typescript
import { z } from 'zod'

export const contactSchema = z.object({
  name: z
    .string()
    .min(2, 'Name must be at least 2 characters')
    .max(100, 'Name must be less than 100 characters'),
  email: z
    .string()
    .email('Please enter a valid email address'),
  company: z
    .string()
    .min(2, 'Company name must be at least 2 characters')
    .max(100, 'Company name must be less than 100 characters'),
  message: z
    .string()
    .min(10, 'Message must be at least 10 characters')
    .max(5000, 'Message must be less than 5000 characters'),
})

export type ContactFormData = z.infer<typeof contactSchema>
```

Create app/actions/contact.ts with the Server Action:

```typescript
'use server'

import { contactSchema } from '@/app/lib/schemas'

export type ContactFormState = {
  success?: boolean
  error?: string
  fieldErrors?: {
    name?: string[]
    email?: string[]
    company?: string[]
    message?: string[]
  }
} | null

export async function submitContactForm(
  prevState: ContactFormState,
  formData: FormData
): Promise<ContactFormState> {
  // Parse and validate form data
  const validatedFields = contactSchema.safeParse({
    name: formData.get('name'),
    email: formData.get('email'),
    company: formData.get('company'),
    message: formData.get('message'),
  })

  // Return validation errors if any
  if (!validatedFields.success) {
    return {
      fieldErrors: validatedFields.error.flatten().fieldErrors,
    }
  }

  const { name, email, company, message } = validatedFields.data

  try {
    // TODO: Integrate with email service (Resend, SendGrid, etc.) in Phase 2+
    // For now, log the submission (would be sent to email service)
    console.log('Contact form submission:', { name, email, company, message })

    // Simulate processing delay
    await new Promise((resolve) => setTimeout(resolve, 500))

    // In production, this would send an email:
    // await sendEmail({
    //   to: 'contact@redleader.com',
    //   subject: `Contact form: ${company}`,
    //   body: `Name: ${name}\nEmail: ${email}\nCompany: ${company}\n\nMessage:\n${message}`,
    // })

    return { success: true }
  } catch (error) {
    console.error('Contact form error:', error)
    return {
      error: 'Something went wrong. Please try again or call us directly.',
    }
  }
}
```

Note: Email integration will be added in a future phase. For now, the Server Action validates and logs submissions.
  </action>
  <verify>
    Schema exports contactSchema and ContactFormData type
    Server Action exports submitContactForm
    Validation returns proper error structure for invalid input
    Action returns success: true for valid submissions
  </verify>
  <done>
    Zod schema with validation for 4 required fields
    Server Action with validation and error handling
    Type-safe form state management
    Ready for email service integration in future phase
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ContactForm component and contact page</name>
  <files>
    app/components/ContactForm.tsx
    app/(marketing)/contact/page.tsx
  </files>
  <action>
Create app/components/ContactForm.tsx as a Client Component:

```typescript
'use client'

import { useActionState } from 'react'
import { useFormStatus } from 'react-dom'
import { submitContactForm, type ContactFormState } from '@/app/actions/contact'

function SubmitButton() {
  const { pending } = useFormStatus()

  return (
    <button
      type="submit"
      disabled={pending}
      className="w-full bg-brand-red text-white py-3 px-6 rounded-lg font-semibold hover:bg-brand-red-dark transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
    >
      {pending ? (
        <span className="flex items-center justify-center gap-2">
          <svg
            className="animate-spin h-5 w-5"
            fill="none"
            viewBox="0 0 24 24"
          >
            <circle
              className="opacity-25"
              cx="12"
              cy="12"
              r="10"
              stroke="currentColor"
              strokeWidth="4"
            />
            <path
              className="opacity-75"
              fill="currentColor"
              d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
            />
          </svg>
          Sending...
        </span>
      ) : (
        'Send Message'
      )}
    </button>
  )
}

function FieldError({ errors }: { errors?: string[] }) {
  if (!errors?.length) return null

  return (
    <p className="mt-1 text-sm text-red-600" role="alert">
      {errors[0]}
    </p>
  )
}

export function ContactForm() {
  const [state, formAction] = useActionState<ContactFormState, FormData>(
    submitContactForm,
    null
  )

  if (state?.success) {
    return (
      <div className="bg-green-50 border border-green-200 rounded-lg p-6 text-center">
        <svg
          className="w-12 h-12 text-green-600 mx-auto mb-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            strokeLinecap="round"
            strokeLinejoin="round"
            strokeWidth={2}
            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
          />
        </svg>
        <h3 className="text-lg font-semibold text-green-800 mb-2">
          Message Sent!
        </h3>
        <p className="text-green-700">
          Thank you for reaching out. We'll respond within 15 minutes during business hours.
          For emergencies, please call us directly.
        </p>
      </div>
    )
  }

  return (
    <form action={formAction} className="space-y-6">
      {state?.error && (
        <div className="bg-red-50 border border-red-200 rounded-lg p-4" role="alert">
          <p className="text-red-700">{state.error}</p>
        </div>
      )}

      <div>
        <label
          htmlFor="name"
          className="block text-sm font-medium text-brand-dark mb-1"
        >
          Name
        </label>
        <input
          id="name"
          name="name"
          type="text"
          required
          className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-red focus:border-transparent transition-shadow"
          placeholder="Your name"
        />
        <FieldError errors={state?.fieldErrors?.name} />
      </div>

      <div>
        <label
          htmlFor="email"
          className="block text-sm font-medium text-brand-dark mb-1"
        >
          Email
        </label>
        <input
          id="email"
          name="email"
          type="email"
          required
          className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-red focus:border-transparent transition-shadow"
          placeholder="you@company.com"
        />
        <FieldError errors={state?.fieldErrors?.email} />
      </div>

      <div>
        <label
          htmlFor="company"
          className="block text-sm font-medium text-brand-dark mb-1"
        >
          Company
        </label>
        <input
          id="company"
          name="company"
          type="text"
          required
          className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-red focus:border-transparent transition-shadow"
          placeholder="Your company name"
        />
        <FieldError errors={state?.fieldErrors?.company} />
      </div>

      <div>
        <label
          htmlFor="message"
          className="block text-sm font-medium text-brand-dark mb-1"
        >
          What can we help you with?
        </label>
        <textarea
          id="message"
          name="message"
          rows={5}
          required
          className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-red focus:border-transparent transition-shadow resize-y"
          placeholder="Describe your situation or what you're looking for..."
        />
        <FieldError errors={state?.fieldErrors?.message} />
      </div>

      <SubmitButton />
    </form>
  )
}
```

Create app/(marketing)/contact/page.tsx:

```typescript
import type { Metadata } from 'next'
import { ContactForm } from '@/app/components/ContactForm'
import { CalendlyEmbed } from '@/app/components/CalendlyEmbed'

export const dynamic = 'force-static'

export const metadata: Metadata = {
  title: 'Contact Us - Red Leader',
  description: 'Get in touch with Red Leader. 24/7 emergency support, consultation booking, and general inquiries.',
}

export default function ContactPage() {
  const emergencyPhone = process.env.NEXT_PUBLIC_EMERGENCY_PHONE || '+1-555-123-4567'
  const contactEmail = 'contact@redleader.com'

  return (
    <>
      {/* Hero Section */}
      <section className="bg-brand-dark text-white py-16 sm:py-20">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
          <h1 className="text-4xl sm:text-5xl font-bold">
            Get in Touch
          </h1>
          <p className="mt-4 text-xl text-gray-300 max-w-2xl mx-auto">
            Whether you're facing an emergency or planning ahead, we're here to help.
          </p>
        </div>
      </section>

      {/* Emergency Banner */}
      <section className="bg-brand-red text-white py-6">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex flex-col md:flex-row items-center justify-center gap-4 text-center md:text-left">
            <div className="flex items-center gap-2">
              <span className="relative flex h-3 w-3">
                <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-300 opacity-75" />
                <span className="relative inline-flex rounded-full h-3 w-3 bg-red-200" />
              </span>
              <span className="font-semibold">Having an emergency?</span>
            </div>
            <a
              href={`tel:${emergencyPhone.replace(/[^+\d]/g, '')}`}
              className="inline-flex items-center px-6 py-2 bg-white text-brand-red font-bold rounded-lg hover:bg-gray-100 transition-colors"
            >
              <svg
                className="w-5 h-5 mr-2"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  strokeWidth={2}
                  d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"
                />
              </svg>
              Call Now: {emergencyPhone}
            </a>
          </div>
        </div>
      </section>

      {/* Contact Methods Grid */}
      <section className="py-16 sm:py-20">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="grid lg:grid-cols-2 gap-12 lg:gap-16">
            {/* Contact Form */}
            <div>
              <h2 className="text-2xl sm:text-3xl font-bold text-brand-dark mb-6">
                Send Us a Message
              </h2>
              <p className="text-brand-gray mb-8">
                Fill out the form below and we'll get back to you within 15 minutes
                during business hours.
              </p>
              <ContactForm />
            </div>

            {/* Contact Info */}
            <div>
              <h2 className="text-2xl sm:text-3xl font-bold text-brand-dark mb-6">
                Contact Information
              </h2>

              <div className="space-y-6">
                {/* Emergency Phone */}
                <div className="flex items-start gap-4">
                  <div className="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <svg
                      className="w-6 h-6 text-brand-red"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        strokeWidth={2}
                        d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"
                      />
                    </svg>
                  </div>
                  <div>
                    <h3 className="font-semibold text-brand-dark">Emergency Hotline</h3>
                    <p className="text-brand-gray mb-1">Available 24/7/365</p>
                    <a
                      href={`tel:${emergencyPhone.replace(/[^+\d]/g, '')}`}
                      className="text-brand-red font-semibold hover:text-brand-red-dark transition-colors"
                    >
                      {emergencyPhone}
                    </a>
                  </div>
                </div>

                {/* Email */}
                <div className="flex items-start gap-4">
                  <div className="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <svg
                      className="w-6 h-6 text-brand-red"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        strokeWidth={2}
                        d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                      />
                    </svg>
                  </div>
                  <div>
                    <h3 className="font-semibold text-brand-dark">Email</h3>
                    <p className="text-brand-gray mb-1">For non-urgent inquiries</p>
                    <a
                      href={`mailto:${contactEmail}`}
                      className="text-brand-red font-semibold hover:text-brand-red-dark transition-colors"
                    >
                      {contactEmail}
                    </a>
                  </div>
                </div>

                {/* Response Time */}
                <div className="flex items-start gap-4">
                  <div className="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <svg
                      className="w-6 h-6 text-brand-red"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        strokeWidth={2}
                        d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                      />
                    </svg>
                  </div>
                  <div>
                    <h3 className="font-semibold text-brand-dark">Response Time</h3>
                    <p className="text-brand-gray">
                      Emergency calls: Immediate<br />
                      Email/form: Within 15 minutes (business hours)
                    </p>
                  </div>
                </div>
              </div>

              {/* Quick Links */}
              <div className="mt-8 p-6 bg-gray-50 rounded-lg">
                <h3 className="font-semibold text-brand-dark mb-4">
                  Looking for something specific?
                </h3>
                <ul className="space-y-2">
                  <li>
                    <a
                      href="/services#emergency-recovery"
                      className="text-brand-red hover:text-brand-red-dark transition-colors"
                    >
                      Emergency Recovery Services →
                    </a>
                  </li>
                  <li>
                    <a
                      href="/services"
                      className="text-brand-red hover:text-brand-red-dark transition-colors"
                    >
                      All Services →
                    </a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </section>

      {/* Calendly Section */}
      <section className="py-16 sm:py-20 bg-gray-50">
        <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="text-center mb-8">
            <h2 className="text-3xl sm:text-4xl font-bold text-brand-dark">
              Book a Consultation
            </h2>
            <p className="mt-4 text-lg text-brand-gray">
              Schedule a time to discuss your infrastructure needs with our team.
            </p>
          </div>
          <CalendlyEmbed className="bg-white rounded-lg shadow-lg overflow-hidden" />
        </div>
      </section>
    </>
  )
}
```
  </action>
  <verify>
    Contact page renders at /contact
    Form has exactly 4 fields: name, email, company, message
    Form validates input and shows field-level errors
    Form shows success message after submission
    Page includes click-to-call and email contact
    Calendly embed loads in booking section
    Page is responsive on all breakpoints
  </verify>
  <done>
    Contact page with validated form (4 fields max per CONV-02)
    Server Action with Zod validation
    Multiple contact methods (phone, email)
    Calendly booking embed
    Success/error states for form submission
    Responsive design across all breakpoints
  </done>
</task>

</tasks>

<verification>
After completing all tasks:

1. Run `npm run dev` and visit http://localhost:3000/contact
2. Test form with invalid input - verify field errors appear
3. Test form with valid input - verify success message
4. Verify only 4 fields in form (name, email, company, message)
5. Verify click-to-call link works (opens phone on mobile)
6. Verify email link works (opens mail client)
7. Verify Calendly widget loads in booking section
8. Test on mobile viewport - verify responsive layout
9. Check server logs for form submission output
10. Run `npm run build` - verify everything compiles
</verification>

<success_criteria>
- Contact form with exactly 4 fields submits successfully (CONV-02)
- Form validation with clear error messages
- Multiple contact methods available (phone, email)
- Calendly embed for booking (CONV-01)
- Contact page accessible at /contact (PAGE-06)
- Responsive design on all breakpoints (TECH-03)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-core-conversion/01-05-SUMMARY.md`
</output>
